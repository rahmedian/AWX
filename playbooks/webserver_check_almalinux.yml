---
- name: Verificaci√≥n Detallada de Servidores Web - AlmaLinux 9
  hosts: all
  gather_facts: no
  become: yes
  
  tasks:
    - name: Verificar Apache en profundidad
      shell: |
        if rpm -q httpd &>/dev/null; then
          echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
          echo "              INFORMACI√ìN DE APACHE"
          echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
          echo ""
          echo "üì¶ RPM Package:"
          rpm -qi httpd | grep -E "Name|Version|Release|Install Date"
          echo ""
          echo "üîß Versi√≥n del binario:"
          /usr/sbin/httpd -v | head -2
          echo ""
          echo "‚öôÔ∏è  Estado del servicio:"
          systemctl status httpd --no-pager -l | head -10
          echo ""
          echo "üîå Puertos de escucha:"
          ss -tlnp | grep httpd
          echo ""
          echo "üìÅ Archivos de configuraci√≥n principales:"
          ls -lh /etc/httpd/conf/httpd.conf /etc/httpd/conf.d/*.conf 2>/dev/null | awk '{print $9, "("$5")"}'
          echo ""
          echo "üåê Virtual Hosts configurados:"
          /usr/sbin/httpd -t -D DUMP_VHOSTS 2>&1 | grep -v "Syntax OK"
          echo ""
        else
          echo "‚ùå Apache (httpd) NO est√° instalado"
        fi
      register: apache_detail
      changed_when: false
      failed_when: false
    
    - name: Verificar Nginx en profundidad
      shell: |
        if rpm -q nginx &>/dev/null; then
          echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
          echo "               INFORMACI√ìN DE NGINX"
          echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
          echo ""
          echo "üì¶ RPM Package:"
          rpm -qi nginx | grep -E "Name|Version|Release|Install Date"
          echo ""
          echo "üîß Versi√≥n del binario:"
          nginx -v 2>&1
          echo ""
          echo "‚öôÔ∏è  Estado del servicio:"
          systemctl status nginx --no-pager -l | head -10
          echo ""
          echo "üîå Puertos de escucha:"
          ss -tlnp | grep nginx
          echo ""
          echo "üìÅ Archivos de configuraci√≥n:"
          ls -lh /etc/nginx/nginx.conf /etc/nginx/conf.d/*.conf 2>/dev/null | awk '{print $9, "("$5")"}'
          echo ""
          echo "üåê Server Blocks configurados:"
          nginx -T 2>/dev/null | grep -E "server_name|listen" | head -20
          echo ""
        else
          echo "‚ùå Nginx NO est√° instalado"
        fi
      register: nginx_detail
      changed_when: false
      failed_when: false
    
    - name: Mostrar informaci√≥n de Apache
      debug:
        msg: "{{ apache_detail.stdout_lines }}"
    
    - name: Mostrar informaci√≥n de Nginx
      debug:
        msg: "{{ nginx_detail.stdout_lines }}"
